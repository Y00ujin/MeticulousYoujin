## 2.1 앱의 기본 구조


<br>

### 2.1.1 엔트리 포인트와 앱의 초기화 과정
##### C언어에 뿌를 둔  모든 애플리케이션은 main()함수로부터 시작됩니다. 이를 엔트리 포인트라고 합니다. 운영체제가 애플리케이션 내부에 정의된 main() 함수를 찾아 호출하면 여기에 작성된 코드들이 연쇄적으로 실행되면서 우리가 작성해 둔 커스텀 코드에까지 도달하는 식입니다.

##### Objective-C 역시 C언어에 기반하고 있기 때문에, 이를 이용하여 만들어진 iOS 앱도 main()함수로부터 시작됩니다. C 기반의 다른 애플리케이션과 차이가 있다면 main() 함수를 우리가 직접 작성하지 않는다는 것 정도입니다.

##### main() 함수는 argc + argv + AppDelegate Class를 가지고 UIApplicationMain()함수를 호출하고 그 결과로 UIApplication 객체를 반환합니다. 생성된 UIApplication 객체는 UIKit 프레임워크에 속해있으므로 이후의 앱 제어권은 UIKit 프레임워크로 이관됩니다.

##### main()함수가 C 기반 애플리케이션의 엔트리 포인트였다면, UIApplicatinoMain() 함수는 그 중에서도 iOS 앱에 속하는 부분의 엔트리 포인트라고 할 수 있습니다. 이 함수는 앱의 핵심 객체를 생성하는 프로세스를 핸들링하고, 스토리보드 파일로부터 앱의 유저 인터페이스를 읽어들일뿐만 아니라 우리가 작성한 커스텀 코드를 호출해 줌으로써 앱 생성 초기에 필요한 설정을 구현할 수 있게 해 줍니다. 여기에 더해서 이벤트를 입력받기 위한 이벤트 루프를 실행시키기도 합니다.

##### UIApplication 객체는 앱의 본체라고 할 수 있으며, 우리가 작성한 코드, 객체, 앱의 기능들이 모두 UIApplication에 포함되어 있는 하위 객체입니다. 이벤트 루프를 관리하고 푸시 알림과 같은 특수한 이벤트를 델리게이트에게 알려주기도 합니다. 

##### UIApplication 객체는 AppDelegate라는 대리 객체를 내세우고 커스텀 코드를 처리할 수 있도록 약간의 권한을 부여합니다. AppDelegate는 UIApplication으로부터 위임받은 일부 권한을 이용하여 커스텀 코드와 상호작용하는 역항르 담당하고, 이를 통해 우리가 필요한 코드를 구현할 수 있도록 도와줍니다.

##### AppDelegate 객체는 iOS 애플리케이션 내에서 오직 하나의 인스턴스만 생성되도록 시스템적으로 보장받습니다. 게다가 앱이 처음 만들어질 때 객체가 생성되고, 앱이 실행되는 동안 계속 유지되다가 앱이 종료되면 그때 함께 소멸하는 등 앱 전체의 생명 주기와 함께 합니다. 이런 특성 때문에 AppDelegate 객체에 데이터를 저장하면 앱이 종료될 때까지 계속 데이터를 유지할 수 있습니다. 따라서 AppDelegate 객체는 종종 앱의 초기 데이터 구조를 설정하기 위해 사용되기도 합니다.

##### UIApplication 객체와 AppDelegate 객체가 연관되어 앱이 실행되는 전체 과정을 정리하면 다음과 같습니다.
- ###### 운영체제에 의해 main() 함수가 실행된다.
- ###### main() 함수가 UIApplicationMain() 함수를 호출한다.
- ###### UIApplicationMain() 함수는 UIApplication 객체를 생성한다.
- ###### UIApplication 객체는 info.plist 파일을 바탕으로 앱에 필요한 데이터와 객체를 로드한다.
- ###### AppDelegate 객체를 생성하고 UIApplication 객체와 연결한다.
- ###### 이벤트 루프를 만드는 등 실행에 필요한 준비를 진행한다.
- ###### 실행 완료 직전, 앱 델리게이트의 application(_:didFinishLaunchingWithOptions:) 메소드를 호출한다.

##### 반면 Swift는 C 기반의 언어가 아닙니다. 따라서 스위프트 기반 프로젝트에는 main.m 파일이 존재하지 않으며 엔트리 포인트 역시 존재하지 않습니다. 이 때문에 Swift에서는 위의 1~5과정을 @UIApplicationMain 어노테이션 표기로 대체합니다.

<br>

### 2.1.2 MVC 패턴
##### iOS 앱의 객체 관계는 MVC 패턴에 기반하고 있습니다. MVC 패턴이란 소스 코드 설계 기법으로써 모델, 뷰, 컨트롤러로 이어지는 세 개의 핵심 구조를 이용하여 애플리케이션을 설계하는 것을 말합니다. 모델은 데이터를 담당하고, 뷰는 데이터에 대한 화면 표현을 담당하며, 컨트롤러는 모델과 뷰 사이에 위치하여 데이터를 가공하여 뷰를 전달하고, 뷰에서 발생하는 이벤트를 입력받아 처리하는 역할을 담당합니다.

##### MVC 패턴은 프로그램을 특성에 따라 서로 영향을 미치지 않을 수 있는 범위로 분리해놓았습니다. 이 패턴을 따르면 데이터 관리 부분을 수정해도 비즈니스 로직이나 화면 표현 코드에는 영향을 미치지 않고, 화면을 표현하는 코드를 수정하더라도 비즈니스 로직이나 데이터 관리 부분에 영향을 미치지 않으므로 훨씬 더 프로그램이 유연해지는 결과를 얻을 수 있습니다.

<br>

### 2.1.3 앱의 상태 변화
##### 앱은 실행되는 동안 다양한 상태로 변화합니다. 이때의 상태란 화면에 나타났거나, 또는 화면으로부터 숨겨졌거나, 시작했거나 종료되었거나 하는 등을 의미합니다.

##### 운영체제인 iOS는 시스템에서 발생하는 특정 상황에 맞게 앱의 상태를 변화시키고 제어합니다. 이를 앱의 라이프 사이클(Life Cycle, 생명 주기)이라고 합니다. 

##### iOS에서 앱이 가질 수 있는 상태값은 다음과 같습니다.
- ###### Not Running : 앱이 시작되지 않았거나 실행되었지만 시스템에 의해 종료된 상태입니다.
- ###### Inactive : 앱이 실행 중이지만, 아무런 이벤트를 받지 않고 있는 상태입니다.
- ###### Active : 앱이 실행 중이며, 이벤트를 받고 있는 상태입니다.
- ###### Background : 앱이 백그라운드에 있지만 여전히 코드가 실행되고 있는 상태입니다. 대부분의 앱은 Suspended 상태로 이행하는 도중에 일시적으로 이 상태에 진입하지만, 파일 다운로드나 업로드, 연산 처리 등 여분의 실행 시간이 필요한 앱일 경우 특정 시간 동안 이 상태로 남아 있게 되는 경우도 있습니다.
- ###### Suspended : 앱이 메모리에 유지되지만 실행되는 코드가 없는 상태입니다. 메모리가 부족한 상황이 오면 iOS 시스템은 포그라운드에 있는 앱의 여유 메모리 공간을 확보하기 위해 Suspended 상태에 있는 앱들을 특별한 알림 없이 정리합니다.

<br>
<br>

##### 앱의 실행 상태가 변화할 때마다 앱 객체는 앱 델리게이트에 정의된 특정 메소드를 호출합니다.
- ###### 앱이 구동되어 필요한 초기 실행 과정이 완료되기 직전에 호출되는 메소드입니다.

```Swift
application(_:willFinishLaunchingWithOptions:)
```
<br>

- ###### 앱이 사용자에게 화면으로 표시되기 직전에 호출되는 메소드입니다. 앱이 실행된 후에 진행할 커슴터마이징이나 초기화를 위한 코드를 여기에 작성하면 됩니다.

```Swift
application(_:didFinishLaunchingWithOptions:)
```
<br>


- ###### 실행된 앱이 포그라운드, 즉 화면 전면에 표시될 때 호출되는 메소드입니다. 앱이 Inactive 상태에 들어가면서 일시 중지된 작업이 있다면 이를 재시작하는 코드를 여기에 작성해 주어야 합니다. 예를 들어 타이머의 경우 Inactive 상태로 들어가면 더 이상 화면 갱신이 이루어지지 않고 예전 화면이 유지되므로 이 메소드를 통해 화면과 남은 시각 등을 갱신해주어야 합니다.

```Swift
applicationDidBecomeActive(_:)
```
<br>

- ###### 앱이 백그라운드 상태에 진입했을 때 호출됩니다. 이 메소드가 호출된다는 것은 미래의 어느 순간에 앱이 종료된다는 의미이므로, 잃어서는 안 되는 사용자 데이터를 종료 전에 미리 저장하거나, 공유 자원을 점유하고 있었다면 이를 해제해 주어야 합니다. 종료된 앱이 다시 실행될 때 현재의 상태를 복구할 수 있도록 필요한 상태 정보도 이 메소드에서 저장 처리하는 것이 좋습니다.

```Swift
applicationDidEnterBackground(_:)
```
<br>

- ###### 앱이 종료되기 직전 호출되는 메소드입니다. 사용자 데이터 등을 종료 전에 한 번 더 저장해두는 것이 좋습니다.

```Swift
applicationWillTerminate(_:)
```